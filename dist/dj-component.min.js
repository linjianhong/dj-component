"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("dj-form",["dj-ui"]),angular.module("dj-pop",["ngAnimate"]),angular.module("dj-ui",["ngAnimate"]),function(e,n,t){function i(e,t,i,a,o,l){function r(n){if(!n)return void t.html("");var i=n.type||"input",a=n.pre+i,r=n.css.hostEdit||n.css.host||"",c="\n        <"+a+'\n          class="'+r+' {{dirty&&\'ng-dirty\'||\'\'}} {{!theValid.valid&&\'ng-invalid\'||\'\'}}"\n          configs="$ctrl.configs"\n          init-value="initValue"\n          on-change="onChange(value)"\n          invalid-text="theValid.tip"\n          dj-require="theValid.require"\n          dj-valid="theValid.valid"\n          dj-dirty="theValid.dirty"\n        ></'+a+">\n      ",s=o(c)(e);t.append(s[0]);var u=e.$$childHead,d=n.template||l.getTemplateEdit(i);s.html(d),o(s.contents())(u)}function c(n){var t=u.valid;return t===e.valid&&n===e.dirty?a.reject("状态未改变"):(e.valid=t,e.dirty=n,a.when({valid:t,dirty:n}))}var s=this,u=e.theValid={valid:!0,require:!1,tip:"",configs:!1,configReady:!1,value:"",valueReady:!1,setConfig:function(e){e&&(u.configs=e,u.configReady=!0,u.calc())},setValue:function(t){return(!u.valueReady||!n.equals(u.value,t))&&(u.valueReady=!0,n.isArray(t)?(u.value=n.merge([],t),e.initValue=n.merge([],t)):n.isObject(t)?(u.value=n.merge({},t),e.initValue=n.merge({},t)):(u.value=t,e.initValue=t),u.calc(),!0)},calc:function(){if(u.configReady&&u.valueReady){var e=u.configs.param&&u.configs.param.valid||u.configs.valid||{},t=n.extend({required:"不可为空"},u.configs.invalid);if(e.minLength&&(e.minlength=e.minlength||e.minLength),e.maxLength&&(e.maxlength=e.maxlength||e.maxLength),u.valid=!0,u.tip="",u.require=e.require,e.require){if(!u.value&&0!==u.value)return u.valid=!1,void(u.tip=t.required||e.errorTip||"")}else if(!u.value&&0!==u.value)return;if(e.pattern&&(e.pattern instanceof RegExp||(e.pattern=new RegExp(e.pattern)),!e.pattern.test(u.value)))return u.valid=!1,void(u.tip=t.pattern||e.errorTip||"");if(e.max){var i="object"==_typeof(u.value)||Number.isNaN(Number(u.value)),a=i||+u.value>e.max;if(a)return u.valid=!1,void(u.tip=(i?t.number:t.max)||e.errorTip||"")}if(e.min){var i="object"==_typeof(u.value)||Number.isNaN(Number(u.value)),a=i||+u.value<e.min;if(a)return u.valid=!1,void(u.tip=(i?t.number:t.min)||e.errorTip||"")}if(e.maxlength){var o=u.value||"",a=!o.hasOwnProperty("length")||o.length>e.maxlength;if(a)return u.valid=!1,void(u.tip=t.maxlength||e.errorTip||"")}if(e.minlength){var o=u.value||"",a=!o.hasOwnProperty("length")||o.length<e.minlength;if(a)return u.valid=!1,void(u.tip=t.minlength||e.errorTip||"")}}}};this.onChangesCtrl=function(n){n.initValue&&(u.setValue(n.initValue.currentValue),e.valid="----",c(!1).then(d)),n.configs&&(r(n.configs.currentValue),u.setConfig(n.configs.currentValue),e.valid="----",c(!1).then(d))},e.valid=!0,e.dirty=!1;var d=function(e){s.onStatusChange&&s.onStatusChange({item:s.configs,valid:e.valid,dirty:e.dirty})};e.onChange=function(n){u.setValue(n)&&c(!0).then(d).finally(function(){s.onValueChange({item:s.configs,value:n,valid:e.valid,dirty:e.dirty})})}}function a(e,n,t,i,a,o){function l(t,i){if(!t)return void n.html("");if(t.show){if("empty"==t.show.autohide&&0!==i&&!i)return void n.html("");if(!("zero length"!=t.show.autohide||i&&i.length))return void n.html("")}var l=t.type||"input",r=t.pre+l,c=t.css.hostShow||t.css.host||"",s="\n        <"+r+'-show\n          class="'+c+'"\n          configs="$ctrl.configs"\n          init-value="$ctrl.initValue"\n        ></'+r+"-show>\n      ",u=a(s)(e);n.append(u[0]);var d=e.$$childHead,m=t.template||o.getTemplateShow(l),f=a(m)(d);u.html(f)}this.onChangesCtrl=function(n){n.configs&&(e.configs=n.configs.currentValue),n.initValue&&(e.value=n.initValue.currentValue),l(e.configs,e.value)}}n.module("dj-form").component("djFormItemHost",{bindings:{mode:"<",configs:"<",initValue:"<",onValueChange:"&",onStatusChange:"&"},controller:["$scope","$element","$timeout","$q","$compile","DjFormDefaultDefine",function(e,n,t,o,l,r){var c=this,s=!1,u={};this.$onChanges=function(d){if(["configs","initValue","onValueChange","onStatusChange"].map(function(e){d[e]&&(u[e]=d[e])}),d.mode){var m=d.mode.currentValue;if("show"!=m&&(m="edit"),m!=s){s=m;("show"==m&&a||i).call(c,e,n,t,o,l,r)}}s&&(c.onChangesCtrl(u),u={})}}]})}(window,angular),function(e,n,t){function i(e,t,i,a,l){function r(n){e.memValue={},"object"===(void 0===n?"undefined":_typeof(n))&&u.ready(function(t){for(var i in n)t.items.find(function(e){return e.name==i})&&(e.memValue[i]=n[i])})}function c(t){if(d={},m={},t){var i=t.templates||{},a=t.pre||o.pre,l=t.css||{};e.configItems=t.items.map(function(e){return n.extend({pre:a,css:l,template:i[e.type]},e)}),t&&u.resolve(t)}}var s=this,u=new l;this.onChangesCtrl=function(e){e.initValues&&r(s.initValues),e.configs&&c(e.configs.currentValue)},e.memValue={},e.valid=!0,e.dirty=!1;var d={},m={};e.onItemStatusChange=function(n,t,a){d[n.name]=t,m[n.name]=a,e.valid=!Object.keys(d).find(function(e){return!d[e]}),e.dirty=!!Object.keys(m).find(function(e){return m[e]}),i(p)};var f={},p=function(){e.valid===f.valid&&e.dirty===f.dirty||(f.valid=e.valid,f.dirty=e.dirty,s.onFormStatus&&s.onFormStatus({valid:e.valid,dirty:e.dirty}))};e.onItemValueChange=function(n,t,i,a){e.onItemStatusChange(n,i,a),e.memValue[n.name]=t,s.onFormValues&&s.onFormValues({value:e.memValue,valid:e.valid,dirty:e.dirty,item:n})}}function a(e){function t(t,i){if(t&&i){var a=t.templates||{},l=t.pre||o.pre,r=t.css||{};e.configItems=t.items.map(function(e){return n.extend({pre:l,css:r,template:a[e.type+"-show"]},e)})}}this.onChangesCtrl=function(n){n.configs&&(e.configs=n.configs.currentValue),n.initValues&&(e.memValue=n.initValues.currentValue),t(e.configs,e.memValue)}}var o={pre:"dj-form-default-item-"};n.module("dj-form").value("DJ_FORM_DEFAULT",o),n.module("dj-form").component("djForm",{bindings:{mode:"<",configs:"<",initValues:"<",onFormValues:"&",onFormStatus:"&"},template:'\n      <dj-form-item-host class="{{$ctrl.configs.css.host || \'flex-v\'}} {{$ctrl.configs.css.host2}} mode-{{mode}}"\n        mode="mode==\'show\' && \'show\' || subItem.mode"\n        configs="subItem"\n        init-value="memValue[subItem.name]"\n        on-status-change="onItemStatusChange(item, valid, dirty)"\n        on-value-change="onItemValueChange(item, value, valid, dirty)"\n        ng-repeat="subItem in configItems track by $index"\n      ></dj-form-item>',controller:["$scope","$element","$timeout","$q","DjWaiteReady",function(e,n,t,o,l){var r=this,c=!1,s={};this.$onChanges=function(u){if(["configs","initValues","onFormValues","onFormStatus"].map(function(e){u[e]&&(s[e]=u[e])}),u.mode){var d=u.mode.currentValue;if("show"!=d&&(d="edit"),d!=c){c=e.mode=d;("show"==d&&a||i).call(r,e,n,t,o,l)}}c&&(r.onChangesCtrl(s),s={})}}]})}(window,angular),function(e,n,t){var i=n.module("dj-pop");i.component("djComponentHost",{bindings:{component:"@",param:"<"},controller:["$scope","$element","$compile",function(e,n,t){function i(i,a){if(!i)return void n.html("");var o="";if(a)for(var l in a)e[l]=a[l],o+=" "+l+'="'+l+'"';n.html('<div class="dj-pop-box"><'+i+" "+o+"></"+i+"></div>"),t(n.contents())(e)}var a=this;e.ZZZ="DJ_POP",this.$onChanges=function(e){return e.component&&e.param?void i(e.component.currentValue,e.param.currentValue):e.component?void i(e.component.currentValue,a.param):e.param?void i(a.component,e.param.currentValue):void 0}}]}),i.component("djPopBox",{bindings:{component:"@"},template:'<dj-component-host param="param || options.param" component="{{$ctrl.component}}"></dj-component-host>'}),i.component("djPopToastBox",{bindings:{},template:'<dj-toast delay="{{options.param.delay}}" text="{{options.param.text}}"></dj-toast>'}),i.factory("DjPop",["$compile","$rootScope","DjWaiteReady","$animateCss",function(e,t,i,a){function o(n,a){function o(e){setTimeout(function(){d.$destroy(),u&&u.remove(),u=null}),l.resolve(e)}a=a||{};var l=new i,r=a.element||document.body,c=a.scope||t,s=a.template||'<dj-pop-box component="'+n+'"></dj-pop-box>',u=e(s)(c);r.append(u[0]);var d=u.children().scope();d.options=a;d.$on("dj-pop-box-close",function(e,n){e.preventDefault(),o(n)}),d.$on("$locationChangeStart",function(e){e.preventDefault(),o("locationChange")});return l.ready()}function l(n){function a(e){setTimeout(function(){c.$destroy(),u&&u.remove(),u=null}),o.resolve(e)}if(!n||!n.template)return $q.reject("无模板");var o=new i,l=n.element||document.body,r=n.scope||t,c=r.$new();c.options=n;var s=n.template,u=e(s)(c);l.append(u[0]);c.$on("dj-pop-box-close",function(e,n){e.preventDefault(),a(n)}),c.$on("$locationChangeStart",function(e){e.preventDefault(),a("locationChange")});return o.ready()}function r(e){return o("dj-gallery",e)}function c(e){return e=e||{},e.template='<dj-toast text="'+e.text+'" delay="'+e.delay+'"></dj-toast>',l(e)}function s(e){return e=e||{},n.isString(e)&&(e={title:e}),e.template='\n      <dj-dialog\n        dlg-body="'+e.body+'"\n        dlg-title="'+(e.title||"confirm")+'"\n      ></dj-dialog>',l(e)}return{show:o,toast:c,confirm:s,gallery:r}}])}(window,angular),function(e,n,t){n.module("dj-ui").directive("flexRow",["$q",function(e){return{restrict:"A",link:function(e,n,t){t.$observe("flexRow",function(e){n.addClass("flex flex-left"),n.children().eq(0).addClass("shrink0"),n.children().eq(1).addClass("flex-1"),n.children()[0].style.opacity=.5,e&&(n.children()[0].style.width=e)})}}}]),n.module("dj-ui").directive("brText",["$q",function(e){return{restrict:"A",link:function(e,n,t){t.$observe("brText",function(e){n.html(e.replace(/\n/g,"<br>"))})}}}])}(window,angular),function(e,n,t){function i(e,t,i,a){function o(){e.djFocus=1,i(function(){e.djFocus=""},300)}var l=this;this.$onChanges=function(n){n.focus&&n.focus.currentValue&&o(),n.initValue&&(e.ngModel=n.initValue.currentValue)},e.onChange=function(e){l.onChange({value:e,initValue:e})},e.clearContent=function(){e.ngModel="",o(),l.onChange({value:e.ngModel})},e.submitText=function(){var t=l.param||{};n.isFunction(t.submit)&&t.submit(e.ngModel)},e.scanText=function(){var n=l.param.scan,t=n.beforeScan&&n.beforeScan(e.ngModel);!1!==t&&a.when(t).then(function(e){r()}).catch(function(e){})};var r=function n(){var o=l.param||{},r=o.scan||{};t.post("扫描二维码").then(function(t){e.ngModel=t,l.onChange({value:e.ngModel});var o=r.onText&&r.onText(t);o&&a.when(o).then(function(e){e&&e.reScan&&i(n,e&&e.delay||r.delay||600)})})}}n.module("dj-ui").component("djuiInput",{bindings:{param:"=",placeholder:"@",icon:"@",focus:"@",initValue:"<",onChange:"&"},template:'\n        <div class="flex">\n          <i class="fa fa-{{$ctrl.icon || $ctrl.param.icon}}" ng-if="$ctrl.icon || $ctrl.param.icon"></i>\n          <input class="flex-w1"\n            dj-focus="{{djFocus}}"\n            placeholder="{{$ctrl.placeholder}}"\n            ng-model="ngModel"\n            ng-change="onChange(ngModel)"\n          >\n          <i class="fa fa-qrcode" ng-if="$ctrl.param.scan" ng-click="scanText()"></i>\n          <i class="fa fa-check-square-o" ng-if="$ctrl.param.submit" ng-click="submitText()"></i>\n          <i class="fa fa-times-circle" ng-if="$ctrl.param.clear" ng-click="clearContent()"></i>\n        </div>\n        ',controller:["$scope","$http","$timeout","$q",i]})}(window,angular),function(e,n,t){function i(e,n){var t=this;this.$onChanges=function(n){if(n.mode&&(e.mode=n.mode.currentValue||""),n.max){var t=+n.max.currentValue;(!t||t<0)&&(t=5),t>20&&(t=20),e.max=t,e.stars=Array.from({length:t+1},function(e,n){return n})}if(n.initValue){var i=+n.initValue.currentValue||0;e.value=i}},e.valueOver=-1,e.leave=function(){"show"!=e.mode&&(e.valueOver=-1)},e.overstar=function(n){"show"!=e.mode&&(e.valueOver=n)},e.click=function(n){"show"!=e.mode&&(e.value=n,t.onChange({value:n}))}}n.module("dj-ui").component("djuiStar",{bindings:{mode:"@",max:"<",initValue:"<",onChange:"&"},template:'\n        <div class="flex flex-left flex-v-center" ng-mouseleave="leave()">\n          <span class="star flex-cc" nth="{{i}}"\n            ng-repeat="i in stars"\n            ng-mouseover="overstar(i)"\n            ng-mouseup="click(i)"\n          >{{i>0 && ((valueOver<0 && i<=value || i<=valueOver) && \'★\' || \'☆\') || \'\'}}</span>\n        </div>\n        ',controller:["$scope","$element",i]})}(window,angular),function(e,n,t){n.module("dj-ui").component("djuiTags",{bindings:{param:"<",list:"<",initValue:"<",onChange:"&",editable:"@"},template:'\n        <div class="flex flex-left flex-wrap">\n          <div class="tag flex-cc {{selected[item.value||item]&&\'active\'||\'\'}}"\n            ng-repeat="item in list"\n            ng-click="clickItem(item)"\n          >{{item.title||item}}</div>\n        </div>\n        ',controller:["$scope","$element",function(e,t){function i(){e.list&&e.value&&(e.selected={},e.value.map(function(n){e.selected[n]=1}))}var a=this;this.$onChanges=function(t){if(t.list&&(e.list=t.list.currentValue||[],i()),t.initValue){var a=t.initValue.currentValue;n.isArray(a)||(a=[]),e.value=a,i()}t.editable},e.clickItem=function(n){var t=n.value||n;(e.selected[t]=!e.selected[t])?e.value.push(t):e.value=e.value.filter(function(e){return e!=t}),a.onChange({value:e.value})}}]}),n.module("dj-ui").component("djuiTagsShow",{bindings:{list:"<"},template:'\n        <div class="flex flex-left flex-wrap">\n          <div class="tag flex-cc" ng-repeat="item in list">{{item}}</div>\n        </div>\n        ',controller:["$scope","$element",function(e,t){this.$onChanges=function(t){if(t.list){var i=t.list.currentValue;n.isArray(i)||(i=[]),e.list=i}}}]})}(window,angular),function(e,n,t){n.module("dj-ui").factory("DjWaiteReady",["$q",function(e){function n(){this._isReady=!1,this.deferred=e.defer(),this.promise=this.deferred.promise}return n.prototype={get isReady(){return this._isReady},resolve:function(e){this.isReady||(this.deferred.resolve(e),this._isReady=!0),this.promise=e},reject:function(e){this.isReady||this.deferred.reject(e),this._isReady="reject",this.promise=e},ready:function(n){return"reject"==this._isReady?e.reject(this.promise):(n&&e.when(this.promise).then(n),e.when(this.promise))}},n}])}(window,angular),function(e,n,t){function i(e,t,a){return!1===e&&i.result?a.when(i.result):e.list?n.isString(e.list)?t.post("获取下拉列表/"+e.list,{}).then(function(e){return a.when(i.result=e.list)}).catch(function(e){return i.result=a.reject([])}):n.isFunction(e.list)?a.when(i.result=e.list()):a.when(i.result=e.list):a.when(i.result=[])}function a(e){var n=m.find(function(n){return n.name==e});return n.editTemplate?d[n.editTemplate]:d[e]?d[e]:d.input}function o(e){var n=m.find(function(n){return n.name==e});return n.showTemplate?d[n.showTemplate]:d[e+"-show"]?d[e+"-show"]:d["input-show"]}function l(e){var n=m.find(function(n){return n.name==e});return n.showController?u[n.showController]:u[e+"-show"]?u[e+"-show"]:u.empty}function r(e){return e.replace(/[:\-_]+(.)/g,function(e,n,t){return t?n.toUpperCase():n})}var c={pre:"dj-form-default-item-"},s=n.module("dj-form"),u={empty:["$scope",function(e){}],input:["$scope",function(e){var n=this;this.$onChanges=function(n){n.initValue&&(e.value=n.initValue.currentValue)},e.change=function(e){n.onChange({value:e})}}],"input-show":["$scope",function(e){this.$onChanges=function(n){n.initValue&&(e.value=n.initValue.currentValue)}}],dropdown:["$scope","$timeout","$http","$q","DjWaiteReady",function(e,n,t,a,o){var l=this,r=new o;e.value="",e.selected="",e.onToggle=function(t){e.focusInput=!1,t&&n(function(){e.focusInput=!0},50)},e.click=function(n){e.selected=n,l.onChange({value:n.value||n})},e.filter=function(n){if(n){var t=new RegExp(n.split("").join("s*"),"i");e.list=e.list_full.filter(function(e){return t.test(e.value?e.value+"-"+e.title:e)})}else e.list=e.list_full},this.$onChanges=function(n){if(n.configs){var o=n.configs.currentValue;if(!o||!o.param)return;e.searchMode=o.param.searchMode,i(o.param,t,a).then(function(n){e.list=e.list_full=n,c(),r.resolve(o)}).catch(function(n){e.list=e.list_full=[]})}n.initValue&&(e.value=n.initValue.currentValue,r.ready(function(n){i(!1).then(function(n){e.list=e.list_full=n,c()})}))};var c=function(){e.list&&(e.selected=e.list.find(function(n){return(n.value||n)==e.value}))}}],"dropdown-show":["$scope","$timeout","$http","$q","DjWaiteReady",function(e,n,t,a,o){var l=new o;e.value="",this.$onChanges=function(n){if(n.configs){var o=n.configs.currentValue;if(!o||!o.param)return;i(o.param,t,a).then(function(n){e.list=e.list_full=n,l.resolve(o)}).catch(function(n){e.list=e.list_full=[]})}if(n.initValue){var r=n.initValue.currentValue;l.ready(function(n){var t=e.list.find(function(e){return e.value==r||e==r});t&&(e.value=t.value||t)})}}}],combobox:["$scope","$http","$q",function(e,n,t){this.$onChanges=function(o){if(o.configs){var l=o.configs.currentValue;if(!l||!l.param)return;i(l.param,n,t).then(function(n){e.list=n,a()}).catch(function(n){e.list=[]})}o.initValue&&(e.value=o.initValue.currentValue,a())};var a=function(){e.list&&(e.selected=e.list.find(function(n){return(n.value||n)==e.value}))}}],tags:["$scope","$http","$q",function(e,n,t){this.$onChanges=function(a){if(a.configs){var o=a.configs.currentValue;if(!o||!o.param)return;i(o.param,n,t).then(function(n){e.list=n}).catch(function(n){e.list=[]})}a.initValue&&(e.value=a.initValue.currentValue)}}],"tags-show":["$scope","$http","$q","DjWaiteReady",function(e,t,a,o){var l=new o;e.value=[],this.$onChanges=function(o){if(o.configs){var r=o.configs.currentValue;if(!r||!r.param)return;i(r.param,t,a).then(function(n){e.list=e.list_full=n,l.resolve(r)}).catch(function(n){e.list=e.list_full=[]})}if(o.initValue){var c=o.initValue.currentValue;if(!n.isArray(c))return;l.ready(function(n){e.value=c.map(function(n){var t=e.list.find(function(e){return e.value==n||e==n});return t?t.value||t:n})})}}}],radio:["$scope",function(e){}],"check-box":["$scope",function(e){}],"imgs-uploader":["$scope",function(e){var t=this;e.initValue=[],this.$onChanges=function(t){if(t.initValue){var i=t.initValue.currentValue||[];n.isArray(i)||(i=[]),e.initValue=i}},e.onChange=function(e){t.onChange({value:e})}}]},d={input:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <djui-input class="flex"\n        param="$ctrl.configs.param"\n        placeholder="{{$ctrl.configs.param.placeholder}}"\n        init-value="$ctrl.initValue"\n        on-change="$ctrl.onChange({value: value})"\n      ></djui-input>',"input-show":'\n      <div flex-row="5em" class="{{$ctrl.configs.css.hostBodyShow}}">\n        <span>{{$ctrl.configs.title}}</span>\n        <span >{{$ctrl.initValue}}</span>\n      </div>',textarea:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <textarea\n        ng-model="value"\n        ng-change="change(value)"\n        placeholder="{{$ctrl.configs.param.placeholder}}"\n      ></textarea>',"textarea-show":'\n      <div flex-row="5em" class="{{$ctrl.configs.css.hostBodyShow}}">\n        <span>{{$ctrl.configs.title}}</span>\n        <span br-text="{{$ctrl.initValue}}"></span>\n      </div>',dropdown:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <select class="item-body" ng-model="value" ng-change="$ctrl.onChange({value:value})">\n        <option value="">{{$ctrl.configs.param.placeholder}}</option>\n        <option ng-repeat="item in list track by $index" value="{{item.value||item}}">{{item.title||item}}</option>\n      </select>\n      ',"dropdown-show":'\n      <div flex-row="5em" class="{{$ctrl.configs.css.hostBodyShow}}">\n        <span>{{$ctrl.configs.title}}</span>\n        <span>{{text}}</span>\n      </div>',combobox:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <div class="inputs">\n        <select class="item-body" ng-model="value" ng-change="$ctrl.onChange({value:value})">\n          <option value="">{{$ctrl.configs.param.placeholder}}</option>\n          <option ng-repeat="item in list track by $index" value="{{item.value||item}}">{{item.title||item}}</option>\n        </select>\n        <div class="caret-down flex flex-v-center"><div></div></div>\n        <djui-input class="flex"\n          param="$ctrl.configs.param"\n          placeholder="{{$ctrl.configs.param.placeholder}}"\n          init-value="$ctrl.initValue"\n          on-change="$ctrl.onChange({value: value})"\n        ></djui-input>\n      </div>\n      ',"mulity-dropdown":'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <select multiple="multiple" class="item-body multiple" ng-model="value" ng-change="$ctrl.onChange({value:value})">\n        <option value="">{{$ctrl.configs.param.placeholder}}</option>\n        <option ng-repeat="item in list track by $index" value="{{$index}}">{{item.title||item}}</option>\n      </select>\n      ',tags:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <djui-tags class="item-body"\n        list="list"\n        init-value="value"\n        on-change="$ctrl.onChange({value: value})"\n      ></djui-tags>\n      ',"tags-show":'\n      <div flex-row="5em" class="{{$ctrl.configs.css.hostBodyShow}}">\n        <span>{{$ctrl.configs.title}}</span>\n        <djui-tags-show class="item-body"\n          list="value"\n        ></djui-tags-show>\n      </div>\n      ',radio:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n    ',"check-box":'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n    ',star:'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <djui-star\n        init-value="$ctrl.initValue"\n        on-change="$ctrl.onChange({value: value})"\n      ></djui-star>\n    ',"star-show":'\n      <div flex-row="5em" class="{{$ctrl.configs.css.hostBodyShow}}">\n        <span>{{$ctrl.configs.title}}</span>\n        <djui-star\n          init-value="$ctrl.initValue"\n          on-change="$ctrl.onChange({value: value})"\n          mode="show"\n        ></djui-star>\n      </div>\n    ',"imgs-uploader":'\n      <div class="flex prompt-top" dj-form-default-tip></div>\n      <imgs-uploader class="padding-v-1"\n        imgs="initValue"\n        update-img="onChange(imgs)"\n      ></imgs-uploader>',"imgs-uploader-show":'\n      <imgs-uploader class="padding-v-1 {{$ctrl.configs.css.hostBodyShow}}"\n        imgs="$ctrl.initValue"\n        mode="show"\n      ></imgs-uploader>'},m=[{name:"input"},{name:"dropdown",showTemplate:"dropdown-show",showController:"dropdown-show"},{name:"combobox",showTemplate:"input-show",showController:"dropdown-show"},{name:"textarea",controller:"input"},{name:"tags"},{name:"radio"},{name:"star",controller:"input"},{name:"check-box"},{name:"imgs-uploader"}];s.value("DjFormDefaultTemplate",d),s.value("DjFormDefaultDefine",{templates:d,defines:m,controlers:u,getTemplateEdit:a,getTemplateShow:o}),m.map(function(e){s.component(r(""+c.pre+e.name),{bindings:{configs:"<",djDirty:"<",djValid:"<",invalidText:"<",djRequire:"<",initValue:"<",onChange:"&"},template:"",controller:u[e.controller||e.name||"empty"]}),s.component(r(""+c.pre+e.name+"-show"),{bindings:{configs:"<",initValue:"<"},template:"",controller:l(e.name)})}),s.directive(r("dj-form-default-tip"),function(){return{restrict:"A",template:"\n        <div class=\"flex title\" dj-form-default-tip-mini></div>\n        <div class=\"prompt error\">{{$ctrl.djValid && ' ' || $ctrl.configs.valid.errorTip || '数据不合法'}}</div>\n      "}}).directive(r("dj-form-default-tip-mini"),function(){return{restrict:"A",template:"\n        <div class=\"require\">{{$ctrl.djRequire && '*' || ''}}</div>\n        <div class=\"prompt-text\">{{$ctrl.configs.title}}</div>\n      "}})}(window,angular),function(e,n,t){n.module("dj-pop").component("djCommentFeedbackShow",{bindings:{item:"<",user:"<",clickItem:"&"},template:'\n      <div class="feedback-top" ng-if="item.praise.length || item.feedback.length">\n      </div>\n      <div class="praise-list" ng-if="item.praise.length">\n        <i class="fa fa-heart-o"></i>\n        <span class="" ng-repeat="uid in item.praise track by $index">{{user[uid].nickname}}</span>\n      </div>\n      <div class="feedback-list" ng-if="item.feedback.length">\n        <div class="feedback-item" ng-mousedown="clickItem(item, feed.uid)" ng-repeat="feed in item.feedback track by $index">\n          <span class="username">{{user[feed.uid].nickname}}</span>\n          <span ng-if="feed.attr.fuid && feed.attr.fuid!=\'0\'">回复 <span class="username">{{user[feed.attr.fuid].nickname}}</span></span>\n          <span class="feedback-content">: {{feed.attr.content}}</span>\n        </div>\n      </div>\n    ',controller:["$scope","$http","$q","$animateCss",function(e,n,t,i){var a=this;this.$onChanges=function(n){n.item&&(e.item=n.item.currentValue),n.user&&(e.user=n.user.currentValue)},e.clickItem=function(e,n){a.clickItem({item:e,fuid:n})}}]})}(window,angular),function(e,n,t){n.module("dj-pop").component("djCommentFeedback",{bindings:{param:"<"},template:'\n      <div class="dj-comment-box dj-comment-feedback-box  flex-v flex-stretch flex-between">\n        <div class="list flex-1" ng-click="closeFeedback()">\n          <div class="item flex flex-top" ng-repeat="item in [param.item]" >\n            <div class="left flex-1">\n              <img ng-src="{{user[item.uid].headimgurl}}"/>\n            </div>\n            <div class="right flex-6">\n              <div class="flex user-info">\n                <div class="name">{{user[item.uid].nickname}}</div>\n                <div class="level">{{user[item.uid].level}}</div>\n              </div>\n              <div class="content-box">\n                <div class="content {{more_content&&\' \' ||\' more\'}}" ng-click="more_content = !more_content">{{item.attr.content}}</div>\n                <div class="imgs" ng-if="item.attr.imgs.length">\n                  <img ng-src="{{url}}" ng-click="clickImg(item.attr.imgs, $index)" ng-repeate="url in item.comment.imgs track by $index">\n                </div>\n              </div>\n              <dj-comment-feedback-show item="item" user="user"></dj-comment-feedback-show>\n            </div>\n          </div>\n        </div>\n        <div class="feedback-box flex-v">\n          <div class="user" ng-if="param.fuid">回复 <span class="username">{{user[param.fuid].nickname}}</span></div>\n          <div class="flex input-box">\n            <input class="flex-1" ng-model="feedbackText">\n            <button class="btn btn-default shrink0" ng-click="sendFeedback(feedbackText)">回复</button>\n          </div>\n        </div>\n      </div>\n    ',controller:["$scope","$http","$q","$animateCss",function(e,t,i,a){(function(){e.active=0,e.pageCount=1,e.pop="",this.$onChanges=function(n){if(n.param){if(!n.param.currentValue)return;var t=e.param=n.param.currentValue;e.user=t.user,e.post=t.post}}}).call(this),e.closeFeedback=function(){e.$emit("dj-pop-box-close",{})},e.sendFeedback=function(t){var i=e.param,a=i.fuid,o=i.item,l=i.me;i.post("comment","feedback",{cid:o.id,fuid:a,content:t}).then(function(i){n.isArray(o.feedback)||(o.feedback=[]),o.feedback.push({uid:l.uid,attr:{content:t}}),e.closeFeedback()}).catch(function(e){})}}]})}(window,angular),function(e,n,t){var i=n.module("dj-pop");i.directive("djCommentInput",function(){return{template:'\n      <div class="flex flex-top dj-comment-form-item input prompt-top">\n        <div class="flex flex-left shrink0 title" dj-form-default-tip-mini></div>\n        <input class="flex-1" ng-model="value" ng-change="change(value)" placeholder="{{$ctrl.configs.param.placeholder}}">\n      </div>\n      '}}),i.directive("djCommentTextarea",function(){return{template:'\n      <div class="flex flex-top dj-comment-form-item input prompt-top">\n        <div class="flex flex-left shrink0 title" dj-form-default-tip-mini></div>\n        <textarea class="flex-1" ng-model="value" ng-change="change(value)" placeholder="{{$ctrl.configs.param.placeholder}}">\n        </textarea>\n      </div>\n      '}}),i.directive("djCommentDropdown",function(){return{template:'\n      <div class="flex flex-top dj-comment-form-item dropdown prompt-top">\n        <div class="flex flex-left shrink0 title" dj-form-default-tip-mini></div>\n        <select class="item-body" ng-model="value" ng-change="$ctrl.onChange({value:value})">\n          <option value="">{{$ctrl.configs.param.placeholder}}</option>\n          <option ng-repeat="item in list track by $index" value="{{$index}}">{{item.title||item}}</option>\n        </select>\n      </div>\n      '}}),i.directive("djCommentImgsUploader",function(){return{template:'\n      <div class="flex dj-comment-form-item imgs-uploader prompt-top">\n        <div class="flex flex-left shrink0 title" dj-form-default-tip-mini></div>\n        <imgs-uploader class="padding-v-1 flex-1"\n          imgs="initValue"\n          update-img="onChange(imgs)"\n        ></imgs-uploader>\n      </div>\n      '}})}(window,angular),function(e,n,t){n.module("dj-pop").component("djCommentPublish",{bindings:{param:"<"},template:'\n      <div class="dj-comment-box publish flex-v flex-stretch">\n        <div class="title flex flex-v-center flex-stretch">\n          <div class="flex-cc btn" ng-click="cancel()">取消</div>\n          <div class="flex-cc btn {{!valid&&\'disabled\'}}" ng-click="publish()">发表</div>\n        </div>\n        <div class="body flex-1 flex-v">\n          <dj-form\n            configs="param.form"\n            init-values="formValue"\n            on-form-values="formValueChange(value, item, valid, dirty)"\n            on-form-status="formStatusChange(item, valid, dirty)"\n          ></dj-form>\n        </div>\n      </div>\n    ',controller:["$scope","$http","$q","$animateCss",function(e,n,t,i){(function(){this.$onChanges=function(n){if(n.param){if(!n.param.currentValue)return;var t=e.param=n.param.currentValue;e.me=t.em}}}).call(this),e.cancel=function(){e.$emit("dj-pop-box-close",{})},e.publish=function(){e.valid&&e.$emit("dj-pop-box-close",{ac:"submit",value:e.value})},function(){e.valid=!1,e.value={},e.formValueChange=function(n,t,i,a){e.value=n,e.formStatusChange(t,i,a)},e.formStatusChange=function(n,t,i){e.valid=t}}.call(this)}]})}(window,angular),function(e,n,t){var i=n.module("dj-pop"),a={form_css:{form:"flex publish",form2:"",hostEdit:"box flex flex-top",hostShow:"flex-1",hostBodyShow:"flex-1 flex-top"},form:{items:[{name:"content",title:"评论",type:"textarea",param:{valid:{require:!0},placeholder:"在此发表评论"}},{name:"pics",title:"图片",type:"imgs-uploader"}],templates___:{input:"<dj-comment-input></dj-comment-input>",textarea:"<dj-comment-textarea></dj-comment-textarea>",dropdown:"<dj-comment-dropdown></dj-comment-dropdown>","imgs-uploader":"<dj-comment-imgs-uploader></dj-comment-imgs-uploader>"}},api:{comment:{root:"./comment/",li:"li",remove:"remove",add:"add",praise:"praise",unpraise:"unpraise",feedback:"feedback",removeFeedback:"removeFeedback"},user:{root:"./app/",getWxInfo:"getWxInfo",me:"me"}}};i.component("djCommentList",{bindings:{param:"<"},transclude:!0,transclude_mark:{header:"?djCommentHeader",content:"?djCommentContent",footer:"?djCommentFooter"},
template:'\n      <div class="dj-comment-box flex-v flex-stretch">\n        <div class="header transclude-header"></div>\n        <div class="list">\n          <div class="item flex flex-top" ng-repeat="item in items track by $index" >\n            <div class="left flex-1">\n              <img ng-src="{{user[item.uid].headimgurl}}"/>\n            </div>\n            <div class="right flex-6">\n              <div class="main">\n                <dj-comment-item form="form" user="user" item="item" contentbody="contentbody"></dj-comment-item>\n                \n    <div class="flex info">\n      <div class="flex info">\n        <div class="eb-time" am-time-ago="1000*item.t_update"></div>\n        <span class="eb-action"\n          ng-if="item.uid==me.uid"\n          ng-click="deleteComment(item)"\n        >删除</span>\n      </div>\n      <div class="back">\n        <div class="btn-feedback" ng-click="showFeedbackMenu($event, item)"></div>\n        <div class="btn-feedback-menu">\n          <div class="flex">\n            <div ac="praise" ng-if="!item.i_praised"><i class="fa fa-heart-o"> </i> 赞</div>\n            <div ac="unpraise" ng-if="item.i_praised"><i class="fa fa-heart-o"> </i> 取消</div>\n            <div ac="feedback"><i class="fa fa-commenting-o"> </i> 评论</div>\n          </div>\n        </div>\n      </div>\n    </div>\n              </div>\n              <dj-comment-feedback-show item="item" user="user" click-item="openFeedback($event, item, fuid)"></dj-comment-feedback-show>\n            </div>\n          </div>\n        </div>\n        <div class="btns transclude-footer">\n          <div class="box-primary btn" ng-click="openPublist()">\n            发贴\n          </div>\n        </div>\n      </div>\n    ',controller:["$scope","$http","$q","$animateCss","$transclude","$element","DjPop",function(e,t,i,o,l,r,c){l(function(n){var t=n.filter("dj-comment-content");t.length>0&&(e.contentbody=t[0].outerText)});var s=function i(a,o,l){return"comment"==a&&(l=n.extend({module:e.param.module,mid:e.param.mid},l)),a=i.api[a],t.post(a.root+(a[o]||o),l)};(function(){e.active=0,e.pageCount=1;var i={};this.$onChanges=function(t){if(t.param){if(!t.param.currentValue)return;var o=n.merge({},t.param.currentValue);o.api=s.api=n.merge({},a.api,o.api),n.equals(i,o)||(i=n.merge({},o),u.loadData(e.param=o))}},e.clickImg=function(e,n){t.post("翻译资源",{urls:e}).then(function(e){var t=e.datas.urls;c.gallery({param:{imgs:t,active:n}})})}}).call(this),e.user={};var u=e.theData={activeItem:!1,loadData:function(n){e.form=n.form||a.form,e.form.css||(e.form.css=a.form_css);var t=s("user","me",{}).then(function(n){e.me=n.datas;var t=n.datas.uid;e.user=e.user||{},e.user[t]=e.user[t]||{},e.user[t].headimgurl=n.datas.wx.headimgurl,e.user[t].nickname=n.datas.wx.nickname}).catch(function(e){});s("comment","li",{count:10}).then(function(n){var a=n.datas.list||[],o=e.items=a.filter(function(e){return"publish"==e.type&&e.attr&&(e.attr.content||e.attr.pics)});o.map(function(e){e.praise=a.filter(function(n){return"praise"==n.type&&n.cid==e.id}).map(function(e){return e.uid}),e.feedback=a.filter(function(n){return"feedback"==n.type&&n.cid==e.id&&n.attr&&(n.attr.content||n.attr.pics)})}),i.when(t).then(function(){o.map(function(n){n.i_praised=!!n.praise.find(function(n){return n==e.me.uid})})});var l=[];a.map(function(e){l.indexOf(e.uid)<0&&l.push(e.uid)}),s("user","getWxInfo",{uids:l}).then(function(n){e.user=e.user||{},n.datas.list.map(function(n){e.user[n.uid]=n})}).catch(function(e){})}).catch(function(n){e.items=[]})}};(function(){function t(a){if(a){var o=n.element(a.target);o.attr("ac")||(o=o.parent()),o.attr("ac")||(o=o.parent()),"praise"==o.attr("ac")&&e.praise(a,s),"unpraise"==o.attr("ac")&&e.unpraise(a,s),"feedback"==o.attr("ac")&&e.openFeedback(a,s)}l.closing?i.when(l.closing).then(t):setTimeout(function(){l(c)})}function a(e,a){i.when(a).then(function(){document.addEventListener("mousedown",t),document.addEventListener("touchstart",t)}),o(n.element(e),{from:{width:"0"},to:{width:"11em"},easing:"ease",duration:.3}).start().then(function(){c=e,r=!1}),r=e}function l(e){if(document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t),!e)return i.when(1);var a=o(n.element(e),{from:{width:"11em"},to:{width:"0"},easing:"ease",duration:.3}),r=i.defer();l.closing=r.promise,a.start().then(function(e){c=!1,l.closing&&(r.resolve("1"),l.closing=!1)}),setTimeout(function(){c=!1,l.closing&&(r.resolve("1"),l.closing=!1)},320)}var r=!1,c=!1,s=!1;e.showFeedbackMenu=function(e,t,o){s=t;var r;l.closing?r=i.when(l.closing).then(function(){l(c)}):l(c);var u=n.element(e.target).parent()[0].querySelector(".btn-feedback-menu");u!==c&&a(u,r)}}).call(this),function(){e.openFeedback=function(n,t,i){function a(){document.removeEventListener("mouseup",a),document.removeEventListener("touchend",a),setTimeout(function(){c.show("dj-comment-feedback",{param:{param:{me:e.me,user:e.user,item:t,fuid:i,post:s}}})})}document.addEventListener("mouseup",a),document.addEventListener("touchend",a)}}.call(this),function(){function n(n,t){s("comment",n,{cid:t.id}).then(function(i){t.praise=t.praise.filter(function(n){return n!=e.me.uid}),t.i_praised="praise"==n,"praise"==n&&(t.praise.push(e.me.uid),t.i_praised=!0)}).catch(function(e){})}e.praise=function(e,t){n("praise",t)},e.unpraise=function(e,t){n("unpraise",t)}}.call(this),function(){e.deleteComment=function(n){t.post("显示对话框/confirm",{body:"删除后，本贴及其回帖和点赞均不可恢复。确认？",title:"删除前，请确认："}).then(function(t){s("comment","remove",{id:n.id}).then(function(t){e.items=e.items.filter(function(e){return e.id!=n.id})})})},e.openPublist=function(){c.show("dj-comment-publish",{param:{param:{me:e.me,user:e.user,form:e.form,post:s}}}).then(function(n){"submit"==n.ac&&s("comment","add",{data:n.value}).then(function(t){e.items.push({id:t.datas.id,uid:e.me.uid,t_update:t.datas.t_update||.001*new Date,type:"publish",praise:[],feedback:[],attr:n.value})}).catch(function(e){})})}}.call(this)}]}),i.component("djCommentItem",{bindings:{form:"<",user:"<",item:"<",contentbody:"<"},template:'\n    <div class="flex user-info">\n      <div class="name">{{$ctrl.user[$ctrl.item.uid].nickname}}</div>\n      <div class="level">{{$ctrl.user[$ctrl.item.uid].level}}</div>\n    </div>\n    <div class="content-box transclude-content"></div>\n    ',controller:["$scope","$element","$compile","$timeout",function(e,n,t,i){function a(a){i(function(){var i=a||o,l=t(i)(e);n.find(".transclude-content").html(l)})}this.$onChanges=function(n){n.item&&(e.item=n.item.currentValue),n.user&&(e.user=n.user.currentValue),n.contentbody&&a(n.contentbody.currentValue)};var o='\n      <div class="content {{more_content&&\' \' ||\' more\'}}" ng-click="more_content = 1">{{$ctrl.item.attr.content}}</div>\n      <div class="imgs flex flex-left flex-wrap" ng-if="$ctrl.item.attr.pics.length">\n        <img ng-src="{{url|assert:90}}" ng-click="clickImg($ctrl.item.attr.pics, $index)" ng-repeat="url in $ctrl.item.attr.pics track by $index">\n      </div>\n      ',o='\n      <dj-form\n        mode="\'show\'"\n        configs="$ctrl.form"\n        init-values="item.attr"\n      ></dj-form-show>\n      '}]})}(window,angular),function(e,n,t){function i(e,n,i,a){e.clickBack=function(){e.onClickBack(),e.backClose&&e.cancel()},e.OK=function(){e.onClose?a.when(e.onClose({$name:"OK"})).then(function(n){e.dialogShow=n!==t&&!n}):e.dialogShow=!1},e.cancel=function(){e.onClose?a.when(e.onClose({$name:"cancel"})).then(function(n){e.dialogShow=n!==t&&!n}):e.dialogShow=!1},e.$on("$locationChangeStart",function(n){e.dialogShow&&(e.cancel(),n.preventDefault())})}n.module("dj-pop").directive("djDialog",function(){return{restrict:"AE",transclude:{title:"?djDialogTitle",body:"?djDialogBody",footer:"?djDialogFooter"},template:'\n        <div ng-if="dialogShow">\n          <div class="weui-mask" ng-click="clickBack()"></div>\n          <div class="weui-dialog">\n            <div class="weui-dialog__hd">\n              <strong class="weui-dialog__title" ng-transclude="title">\n                {{dlgTitle}}\n              </strong>\n            </div>\n            <div class="weui-dialog__bd" ng-transclude="body">\n              <div html-content="dlgBody"></div>\n            </div>\n            <div ng-transclude="footer">\n              <div class="weui-dialog__ft">\n                <span class="weui-dialog__btn weui-dialog__btn_default" ng-if="!hideCancel" ng-click="cancel()">取消</span>\n                <span class="weui-dialog__btn weui-dialog__btn_primary" ng-if="!hideOk" ng-click="OK()">确定</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      ',scope:{dialogShow:"=",backClose:"@",dlgBody:"@",dlgTitle:"@",hideCancel:"@",hideOk:"@",onClose:"&",onClickBack:"&"},controller:["$scope","$element","$rootScope","$q",i]}})}(window,angular),function(e,n,t){n.module("dj-pop").component("djGallery",{bindings:{imgs:"<",active:"<",nav:"@",pageCount:"@",onPage:"&",btns:"<"},transclude:!0,replace:!0,template:'\n      <div class="dj-gallery-box">\n        <div class="dj-gallery-list flex" ng-transclude>\n          <div class="dj-gallery-item item-{{$index+1-active}}" ng-repeat="img in imgs track by $index" >\n            <img class="" ng-src="{{img}}"/>\n          </div>\n        </div>\n        <div class="dj-gallery-nav flex flex-between">\n          <div class="dots flex flex-w1 flex-center" ng-if="1">\n            <div ng-click="scrollTo($index)" ng-repeat="img in imgs track by $index">{{$index==active&&\'●\'||\'○\'}}</div>\n          </div>\n          <div class="btns flex flex-center" ng-if="$ctrl.btns.length">\n            <div ng-click="clickButton(btn)" ng-repeat="btn in $ctrl.btns track by $index">\n              <div class="{{btn.css}}">{{btn.text||\'\'}}</div>\n            </div>\n          </div>\n        </div>\n        <div class="dj-gallery-debug" ng-if="debug">\n          {{debug}}\n        </div>\n        <div class="dj-gallery-top" ng-if="isMoving">\n        </div>\n      </div>\n    ',controller:["$scope","$window","$element","$q","$animateCss",function(e,t,i,a,o){var l=this;e.active=0,e.pageCount=1,this.$onChanges=function(n){n.imgs&&(e.imgs=n.imgs.currentValue||[],e.pageCount=e.imgs.length),n.pageCount&&n.pageCount.currentValue&&(e.pageCount=n.pageCount.currentValue||1,setTimeout(r.init)),n.active&&(e.active=n.active.currentValue||0)},this.$onInit=function(){setTimeout(function(){r.init();var n=i[0];n.addEventListener("mousedown",r.onTouchstart,!0),n.addEventListener("touchstart",r.onTouchstart,!0),n.addEventListener("mousemove",r.onTouchmove,!0),n.addEventListener("touchmove",r.onTouchmove,!0),n.addEventListener("mouseup",r.onTouchend,!0),n.addEventListener("touchend",r.onTouchend,!0),c(e.active)})};var r={min:10,fastPx:5,slowTurn:.3,init:function(){r.box=i[0].querySelector(".dj-gallery-box"),i.children().css("height",i[0].clientHeight),i.children().css("width",i[0].clientWidth);var t=r.box.clientWidth;r.list=i[0].querySelector(".dj-gallery-list"),n.element(r.list).css("width",t*e.pageCount+"px"),n.element(r.list).children().css("width",t+"px")},checkFast:function(e){var n=e-r.fast.t;return!(Math.abs(r.x1-r.fast.x)*r.fastPx<n&&(r.fast={x:r.x1,t:e},1))},minMove:function(e){return r.checkFast(e)?r.box.clientWidth*r.slowTurn*.3:r.box.clientWidth*r.slowTurn},setMoving:function(n){e.isMoving=n,e.$apply()},onTouchstart:function(e){r.touchstart=!0,r.begin=!0,r.moved=!1,r.canceled=!1,r.setMoving(!1),r.x0=r.x1=(e.touches&&e.touches[0]||e).clientX,r.y0=r.y1=(e.touches&&e.touches[0]||e).clientY,r.fast={x:r.x1,t:e.timeStamp},r.offsetLeft=parseInt(r.list.style.left)||0},onTouchmove:function(e){if(r.begin&&!r.canceled){r.touchstart=!0,r.x1=(e.touches&&e.touches[0]||e).clientX,r.y1=(e.touches&&e.touches[0]||e).clientY,r.list.style.left=r.offsetLeft+r.x1-r.x0+"px";var n=Math.abs(r.x1-r.x0),t=Math.abs(r.y1-r.y0);if(!r.moved&&t>r.min&&t>n)return void(r.canceled=!0);(Math.abs(r.x1-r.x0)>=r.min||Math.abs(r.y1-r.y0)>=r.min)&&(r.moved=!0),r.checkFast(e.timeStamp),e.preventDefault(),e.stopPropagation(),r.moved&&r.setMoving(!0)}},onTouchend:function(n){r.begin=!1,r.touchstart=!1;var t=parseInt(r.list.style.left),i=r.offsetLeft-t,a=r.minMove(n.timeStamp);r.moved?c(i>a?e.active+1:i<-a?e.active-1:e.active):e.$emit("dj-pop-box-close",{active:e.active}),r.moved&&(n.preventDefault(),n.stopPropagation()),r.setMoving(!1)}},c=e.scrollTo=function(t){r.init(),t<0&&(t=0),t>=e.pageCount&&(t=e.pageCount-1),e.active=t,o(n.element(r.list),{from:{left:r.list.style.left},to:{left:-t*r.box.clientWidth+"px"},easing:"ease",duration:.2}).start().then(function(n){e.active=t,l.onPage({page:t})}).catch(function(e){})};e.clickButton=function(n){var t=n.fn&&n.fn(e.active);t&&a.when(t).then(function(n){e.pageCount<1&&e.$emit("dj-pop-box-close",{active:e.active}),c(e.active)}).catch(function(e){})}}]})}(window,angular),function(e,n,t){n.module("dj-pop").component("djToast",{bindings:{text:"@",delay:"@"},transclude:!0,template:"<span>{{$ctrl.text}}</span>",controller:["$scope","$element","$q","$animateCss",function(e,t,i,a){function o(e){setTimeout(function(){l().then(function(){u(e)})})}function l(){if(o.done)return i.when(o.done);var e=a(t,{from:{opacity:0},to:{opacity:1},easing:"ease",duration:.5});return o.done=e.start().then(function(){t.css("opacity",1),o.done=1}).catch(function(e){})}function r(){a(t,{from:{opacity:1},to:{opacity:0},easing:"ease",duration:.6}).start().then(function(n){e.$emit("dj-pop-box-close",{})})}var c=this;this.$onChanges=function(e){if(e.delay){var t=+e.delay.currentValue||0;n.isNumber(t)||(t=2e3),t>15e3&&(t=15e3),o(t)}e.text&&o(c.delay)};var s,u=function(e){clearTimeout(s),s=setTimeout(function(){r()},e)}}]})}(window,angular),function(e,n,t){var i=1;n.module("dj-ui").directive("djCollapse",["$rootScope","$parse","$timeout",function(e,n,t){return{restrict:"A",link:function(a,o,l){function r(n){n=n||"0",n=a.$eval(n),o[0].style.height=o[0].scrollHeight+"px",t(function(){o[0].style.overflow="hidden",o[0].style.height=o[0].scrollHeight+"px",o[0].style.height=n?o[0].scrollHeight+"px":"0",n&&e.$broadcast("dj-collapse-open-broadcast",{element:o})})}function c(e){parseInt(o[0].style.height)>0&&(o[0].style.height="auto",o[0].style.overflow="visible")}function s(e){o.djCollapseGroup=e}function u(e,t){if(o!=t.element&&(!o.djCollapseGroup||o.djCollapseGroup===t.element.djCollapseGroup)){var i=n(l.djCollapseGroup);a.$apply(function(){i(a,{element:o})})}}o.djCollapseId=i++,l.$observe("djCollapse",r),l.$observe("group",s),a.$on("dj-collapse-open-broadcast",u),o[0].addEventListener("webkitTransitionEnd",c)}}}])}(window,angular),function(e,n,t){n.module("dj-ui").factory("IMG",["$q","$log",function(n,t){function i(e,n,t,i){var l=s();if(t)for(var r in t)t.hasOwnProperty(r)&&l.append(r,t[r]);return u(n).then(function(t){return o(n,t).then(function(t){return l.append(i||"file",t,n.name),a(e,l)})}).catch(function(e){})}function a(t,i){var a=n.defer(),o=new e.XMLHttpRequest;return o.open("post",t),o.onreadystatechange=function(){if(4==o.readyState){var e=o.status;if(e>=200&&e<300){var n=JSON.parse(o.responseText);a.resolve(n)}else a.reject(o)}},o.upload.onprogress=function(e){a.notify(e)},o.send(i),a.promise}function o(e,t){if(!/\/(?:jpeg|png|gif)/i.test(e.type))return n.reject("不支持的图片格式");var i=n.defer(),a=new FileReader;return a.onload=function(n){function a(){var e=l(c,t),n=r(e);c=null,i.resolve(n)}var o=this.result;if(o.length<=d)return void i.resolve(e);var c=new Image;c.src=o,c.complete?a():c.onload=a},a.readAsDataURL(e),i.promise}function l(e,n){var t=(e.src.length,e.width),i=e.height,a=document.createElement("canvas"),o=a.getContext("2d"),l=t*i/3e6;l>1?(l=Math.sqrt(l),t/=l,i/=l):l=1,a.width=t,a.height=i,o.fillStyle="#fff",o.fillRect(0,0,a.width,a.height);var r=t*i/1e6;if(r>1){r=~~(Math.sqrt(r)+1);var c=~~(t/r),s=~~(i/r),u=document.createElement("canvas"),d=u.getContext("2d");u.width=c,u.height=s;for(var m=0;m<r;m++)for(var f=0;f<r;f++)d.drawImage(e,m*c*l,f*s*l,c*l,s*l,0,0,c,s),o.drawImage(u,m*c,f*s,c,s);u.width=u.height=0}else o.drawImage(e,0,0,t,i);var p=document.createElement("canvas"),v=p.getContext("2d");!function(e,n,t,i,a,o){if(!(e<1||e>8)){var l,r,c=e,s=e>4;s&&(c=9-c),c-=1;var u=[1,-1,-1,1][c],d=[1,1,-1,-1][c];l=-a/2,r=-o/2,s?(n.width=o,n.height=a,t.translate(-r,-l),t.rotate(1.5*Math.PI)):(n.width=a,n.height=o,t.translate(-l,-r)),t.scale(u,d),t.drawImage(i,0,0,a,o,l,r,a,o)}}(n,p,v,a,t,i);var g=p.toDataURL("image/jpeg",.2);return a.width=a.height=0,p.width=p.height=0,g}function r(e){var n,t=e.split(",");n=t[0].indexOf("base64")>=0?atob(t[1]):unescape(t[1]);for(var i=t[0].split(":")[1].split(";")[0],a=new Uint8Array(n.length),o=0;o<n.length;o++)a[o]=n.charCodeAt(o);return new c([a],i)}function c(n,t){try{return new Blob(n,{type:t})}catch(a){var i=new(e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder);return n.forEach(function(e){i.append(e)}),i.getBlob(t)}}function s(){return~navigator.userAgent.indexOf("Android")&&~navigator.vendor.indexOf("Google")&&!~navigator.userAgent.indexOf("Chrome")&&navigator.userAgent.match(/AppleWebKit\/(\d+)/).pop()<=534?new FormDataShim:new FormData}function u(e){var t=n.defer(),i=new FileReader;return i.onload=function(e){var n=new DataView(this.result);if(65496!=n.getUint16(0,!1))return t.resolve(-2);for(var i=n.byteLength,a=2;a<i;){var o=n.getUint16(a,!1);if(a+=2,65505==o){if(1165519206!=n.getUint32(a+=2,!1))return t.resolve(-1);var l=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,l);var r=n.getUint16(a,l);a+=2;for(var c=0;c<r;c++)if(274==n.getUint16(a+12*c,l))return t.resolve(n.getUint16(a+12*c+8,l))}else{if(65280!=(65280&o))break;a+=n.getUint16(a,!1)}}return t.resolve(-1)},i.readAsArrayBuffer(e),t.promise}var d=2e5;return{upload:i}}])}(window,angular),function(){function e(e,n,t,i){var a=this;this.imgData={uploadings:[]};e.imgList=[],this.countError=0,this.$onInit=function(){},this.$onChanges=function(n){if(n.imgs){var t=n.imgs.currentValue||[];e.imgList.splice(0,e.imgList.length),t.map(function(n){return e.imgList.push(n)})}n.maxCount&&(e.maxCount=+n.maxCount.currentValue||9),n.mode&&(e.mode=n.mode.currentValue||"")},this.deleteImg=function(n){if(!(n<0||n>=e.imgList.length))return i.confirm("您确认要删除当前图片?").then(function(t){e.imgList.splice(n,1),a.updateImg({imgs:e.imgList})})},e.clickImg=function(n){i.gallery({param:{imgs:e.imgList,active:n,btns:"show"==e.mode?[]:[{css:"fa fa-trash-o text-visited",fn:a.deleteImg}]}}).then(function(e){}).catch(function(e){})},this.addImg=function(n){e.imgList.length>=e.maxCount||(e.imgList.push(n),a.updateImg({imgs:e.imgList}))};var o=this,l=e.File={subTreeId:0,uploadingFiles:[],onFile:function(n){if(n){l.uploadingFiles=[];for(var t=0;t<n.length;t++)l.uploadingFiles.push(n[t]);e.$apply(),this.upload()}},uploadFile:function(e,n,i){t.upload(e,n,i).then(function(e){e.datas&&o.addImg(e.datas.url);var t=l.uploadingFiles.indexOf(n);l.uploadingFiles.splice(t,1)},function(e){},function(e){n.per=(e.loaded/n.size*80).toFixed(2),n.per>100&&(n.per=100)})},upload:function(){n.post("签名","upload/img").then(function(e){return e.datas}).catch(function(e){return{url:"upload/img",data:{}}}).then(function(e){angular.forEach(l.uploadingFiles,function(n){l.uploadFile(e.url,n,e.data)})})}}}angular.module("dj-ui").filter("preview",function(){return function(e,n,t){return e}}).directive("multiFileUpload",function(){return{controller:["$scope","$element",function(e,n){n.bind("change",function(n){e.change&&e.change({$files:n.target.files})})}],scope:{change:"&"}}}).component("imgsUploader",{template:'\n        <div class="box flex flex-left flex-wrap">\n          <div class="img preview" ng-click="clickImg($index)" ng-repeat=\'img in imgList track by $index\'>\n            <img ng-src="{{img|preview}}" />\n          </div>\n          <div class="img uploading" ng-repeat=\'file in File.uploadingFiles track by $index\'>\n            <div class="per">{{file.per}}%</div>\n          </div>\n          <div class="img add" ng-if="mode!=\'show\' && imgList.length < (maxCount||9)">\n            <input type="file" multiple accept="image/*,video/mp4" multi-file-upload change="File.onFile($files)">\n          </div>\n        </div>\n      ',bindings:{appData:"<",maxCount:"<",imgs:"<",mode:"@",updateImg:"&"},controller:["$scope","$http","IMG","DjPop",e]})}();